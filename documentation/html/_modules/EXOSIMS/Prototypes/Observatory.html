
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>EXOSIMS.Prototypes.Observatory &#8212; EXOSIMS 1.3 documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head><body>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for EXOSIMS.Prototypes.Observatory</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">EXOSIMS.util.vprint</span> <span class="k">import</span> <span class="n">vprint</span>
<span class="kn">from</span> <span class="nn">EXOSIMS.util.eccanom</span> <span class="k">import</span> <span class="n">eccanom</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">import</span> <span class="nn">astropy.constants</span> <span class="k">as</span> <span class="nn">const</span>
<span class="kn">from</span> <span class="nn">astropy.time</span> <span class="k">import</span> <span class="n">Time</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="k">import</span> <span class="n">SkyCoord</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">urllib</span>

<div class="viewcode-block" id="Observatory"><a class="viewcode-back" href="../../../EXOSIMS.Prototypes.html#EXOSIMS.Prototypes.Observatory.Observatory">[docs]</a><span class="k">class</span> <span class="nc">Observatory</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Observatory class template</span>
<span class="sd">    </span>
<span class="sd">    This class contains all variables and methods necessary to perform</span>
<span class="sd">    Observatory Definition Module calculations in exoplanet mission simulation.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        \*\*specs: </span>
<span class="sd">            user specified values</span>
<span class="sd">        spkpath (str):</span>
<span class="sd">            Path to SPK file on disk (Defaults to de432s.bsp). </span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        koAngleMin (astropy Quantity):</span>
<span class="sd">            Telescope minimum keepout angle in units of deg</span>
<span class="sd">        koAngleMinMoon (astropy Quantity):</span>
<span class="sd">            Telescope minimum keepout angle in units of deg, for the Moon only</span>
<span class="sd">        koAngleMinEarth (astropy Quantity):</span>
<span class="sd">            Telescope minimum keepout angle in units of deg, for the Earth only</span>
<span class="sd">        koAngleMax (astropy Quantity):</span>
<span class="sd">            Telescope maximum keepout angle (for occulter) in units of deg</span>
<span class="sd">        koAngleSmall (astropy Quantity):</span>
<span class="sd">            Telescope keepout angle for smaller (angular size) bodies in units of deg</span>
<span class="sd">        settlingTime (astropy Quantity): </span>
<span class="sd">            Instrument settling time after repoint in units of day</span>
<span class="sd">        thrust (astropy Quantity): </span>
<span class="sd">            Occulter slew thrust in units of mN</span>
<span class="sd">        slewIsp (astropy Quantity): </span>
<span class="sd">            Occulter slew specific impulse in units of s</span>
<span class="sd">        scMass (astropy Quantity): </span>
<span class="sd">            Occulter (maneuvering sc) wet mass in units of kg</span>
<span class="sd">        dryMass (astropy Quantity): </span>
<span class="sd">            Occulter (maneuvering sc) dry mass in units of kg</span>
<span class="sd">        coMass (astropy Quantity): </span>
<span class="sd">            Telescope (non-maneuvering sc) mass in units of kg</span>
<span class="sd">        occulterSep (astropy Quantity): </span>
<span class="sd">            Occulter-telescope distance in units of km</span>
<span class="sd">        skIsp (astropy Quantity): </span>
<span class="sd">            Station-keeping specific impulse in units of s</span>
<span class="sd">        defburnPortion (float):</span>
<span class="sd">            Default burn portion</span>
<span class="sd">        flowRate (astropy Quantity): </span>
<span class="sd">            Slew flow rate in units of kg/day</span>
<span class="sd">        checkKeepoutEnd (boolean):</span>
<span class="sd">            Boolean signifying if the keepout method must be called at the end of </span>
<span class="sd">            each observation</span>
<span class="sd">        forceStaticEphem (boolean):</span>
<span class="sd">            Boolean used to force static ephemerides</span>
<span class="sd">        constTOF (astropy Quantity 1x1 ndarray):</span>
<span class="sd">            Constant time of flight for single occulter slew in units of day</span>
<span class="sd">        maxdVpct (float):</span>
<span class="sd">            Maximum percentage of total on board fuel used for single starshade slew</span>
<span class="sd">    </span>
<span class="sd">    Notes:</span>
<span class="sd">        For finding positions of solar system bodies, this routine will attempt to </span>
<span class="sd">        use the jplephem module and a local SPK file on disk.  The module can be </span>
<span class="sd">        installed via pip or from source.  The default SPK file can be downloaded from</span>
<span class="sd">        here: http://naif.jpl.nasa.gov/pub/naif/generic_kernels/spk/planets/de432s.bsp</span>
<span class="sd">        and should be placed in the Observatory subdirectory of EXOSIMS.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_modtype</span> <span class="o">=</span> <span class="s1">&#39;Observatory&#39;</span>
    <span class="n">_outspec</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">koAngleMin</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">koAngleMinMoon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">koAngleMinEarth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">koAngleMax</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">koAngleSmall</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">settlingTime</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">thrust</span><span class="o">=</span><span class="mi">450</span><span class="p">,</span> <span class="n">slewIsp</span><span class="o">=</span><span class="mi">4160</span><span class="p">,</span> 
            <span class="n">scMass</span><span class="o">=</span><span class="mi">6000</span><span class="p">,</span> <span class="n">dryMass</span><span class="o">=</span><span class="mi">3400</span><span class="p">,</span> <span class="n">coMass</span><span class="o">=</span><span class="mi">5800</span><span class="p">,</span> <span class="n">occulterSep</span><span class="o">=</span><span class="mi">55000</span><span class="p">,</span> <span class="n">skIsp</span><span class="o">=</span><span class="mi">220</span><span class="p">,</span> 
            <span class="n">defburnPortion</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">constTOF</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">maxdVpct</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">spkpath</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">checkKeepoutEnd</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
            <span class="n">forceStaticEphem</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">specs</span><span class="p">):</span>
        
        <span class="c1"># load the vprint function (same line in all prototype module constructors)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vprint</span> <span class="o">=</span> <span class="n">vprint</span><span class="p">(</span><span class="n">specs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;verbose&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        
        <span class="c1"># validate inputs</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">checkKeepoutEnd</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span> <span class="s2">&quot;checkKeepoutEnd must be a boolean.&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">forceStaticEphem</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span> <span class="s2">&quot;forceStaticEphem must be a boolean.&quot;</span>
        
        <span class="c1"># default Observatory values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">koAngleMin</span> <span class="o">=</span> <span class="n">koAngleMin</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span>          <span class="c1"># keepout minimum angle</span>
        <span class="n">koAngleMinMoon</span> <span class="o">=</span> <span class="n">koAngleMin</span> <span class="k">if</span> <span class="n">koAngleMinMoon</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">koAngleMinMoon</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">koAngleMinMoon</span> <span class="o">=</span> <span class="n">koAngleMinMoon</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span>  <span class="c1"># keepout minimum angle: Moon-only</span>
        <span class="n">koAngleMinEarth</span> <span class="o">=</span> <span class="n">koAngleMin</span> <span class="k">if</span> <span class="n">koAngleMinEarth</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">koAngleMinEarth</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">koAngleMinEarth</span> <span class="o">=</span> <span class="n">koAngleMinEarth</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="c1"># keepout minimum angle: Earth-only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">koAngleMax</span> <span class="o">=</span> <span class="n">koAngleMax</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span>          <span class="c1"># keepout maximum angle (occulter)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">koAngleSmall</span> <span class="o">=</span> <span class="n">koAngleSmall</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">deg</span>      <span class="c1"># keepout angle for smaller bodies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settlingTime</span> <span class="o">=</span> <span class="n">settlingTime</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">d</span>        <span class="c1"># instru. settling time after repoint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thrust</span> <span class="o">=</span> <span class="n">thrust</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">mN</span>                   <span class="c1"># occulter slew thrust (mN)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slewIsp</span> <span class="o">=</span> <span class="n">slewIsp</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">s</span>                  <span class="c1"># occulter slew specific impulse (s)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scMass</span> <span class="o">=</span> <span class="n">scMass</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kg</span>                   <span class="c1"># occulter initial (wet) mass (kg)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dryMass</span> <span class="o">=</span> <span class="n">dryMass</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kg</span>                 <span class="c1"># occulter dry mass (kg)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coMass</span> <span class="o">=</span> <span class="n">coMass</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">kg</span>                   <span class="c1"># telescope mass (kg)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occulterSep</span> <span class="o">=</span> <span class="n">occulterSep</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">km</span>         <span class="c1"># occulter-telescope distance (km)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skIsp</span> <span class="o">=</span> <span class="n">skIsp</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">s</span>                      <span class="c1"># station-keeping Isp (s)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defburnPortion</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">defburnPortion</span><span class="p">)</span> <span class="c1"># default burn portion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkKeepoutEnd</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">checkKeepoutEnd</span><span class="p">)</span><span class="c1"># true if keepout called at obs end </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forceStaticEphem</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">forceStaticEphem</span><span class="p">)</span><span class="c1"># boolean used to force static ephem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constTOF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">constTOF</span><span class="p">])</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">d</span>    <span class="c1">#starshade constant slew time (day)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxdVpct</span> <span class="o">=</span> <span class="n">maxdVpct</span>

        <span class="c1"># find amount of fuel on board starshade and an upper bound for single slew dV</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dVtot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slewIsp</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">g0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scMass</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">dryMass</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dVmax</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dVtot</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxdVpct</span>        
        
        <span class="c1"># set values derived from quantities above</span>
        <span class="c1"># slew flow rate (kg/day)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flowRate</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thrust</span><span class="o">/</span><span class="n">const</span><span class="o">.</span><span class="n">g0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">slewIsp</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kg/day&#39;</span><span class="p">)</span>
        
        <span class="c1"># if jplephem is available, we&#39;ll use that for propagating solar system bodies</span>
        <span class="c1"># otherwise, use static ephemerides</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">forceStaticEphem</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">jplephem.spk</span> <span class="k">import</span> <span class="n">SPK</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">havejplephem</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vprint</span><span class="p">(</span><span class="s2">&quot;WARNING: Module jplephem not found, &quot;</span> \
                        <span class="o">+</span> <span class="s2">&quot;using static solar system ephemerides.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">havejplephem</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">havejplephem</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vprint</span><span class="p">(</span><span class="s2">&quot;Using static solar system ephemerides.&quot;</span><span class="p">)</span>
        
        <span class="c1"># populate outspec</span>
        <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">att</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;vprint&#39;</span><span class="p">]:</span>
                <span class="n">dat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">att</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_outspec</span><span class="p">[</span><span class="n">att</span><span class="p">]</span> <span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">value</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">Quantity</span><span class="p">)</span> <span class="k">else</span> <span class="n">dat</span>
        
        <span class="c1"># define function for calculating obliquity of the ecliptic </span>
        <span class="c1"># (arg Julian centuries from J2000)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obe</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">TDB</span><span class="p">:</span> <span class="mf">23.439279</span> <span class="o">-</span> <span class="mf">0.0130102</span><span class="o">*</span><span class="n">TDB</span> <span class="o">-</span> <span class="mf">5.086e-8</span><span class="o">*</span><span class="p">(</span><span class="n">TDB</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
                <span class="mf">5.565e-7</span><span class="o">*</span><span class="p">(</span><span class="n">TDB</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.6e-10</span><span class="o">*</span><span class="p">(</span><span class="n">TDB</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.21e-11</span><span class="o">*</span><span class="p">(</span><span class="n">TDB</span><span class="o">**</span><span class="mi">5</span><span class="p">)</span> 
        
        <span class="c1"># if you have jplephem, load spice file, otherwise load static ephem</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">havejplephem</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">spkpath</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">spkpath</span><span class="p">)):</span>
                <span class="c1"># if the path does not exist, load the default de432s.bsp</span>
                <span class="n">classpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">classpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">classpath</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> 
                        <span class="s1">&#39;Observatory&#39;</span><span class="p">))</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;de432s.bsp&#39;</span>
                <span class="n">spkpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">classpath</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                <span class="c1"># attempt to fetch ephemeris and cache locally in EXOSIMS/Observatory/</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">spkpath</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">classpath</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">W_OK</span><span class="o">|</span><span class="n">os</span><span class="o">.</span><span class="n">X_OK</span><span class="p">):</span>
                    <span class="n">spk_on_web</span> <span class="o">=</span> <span class="s1">&#39;https://naif.jpl.nasa.gov/pub/naif/generic_kernels/spk/planets/de432s.bsp&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vprint</span><span class="p">(</span><span class="s2">&quot;Fetching planetary ephemeris from </span><span class="si">%s</span><span class="s2"> to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">spk_on_web</span><span class="p">,</span> <span class="n">spkpath</span><span class="p">))</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">urllib</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">spk_on_web</span><span class="p">,</span> <span class="n">spkpath</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="c1"># Note: the SPK.open() below will fail in this case</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vprint</span><span class="p">(</span><span class="s2">&quot;Error: Remote fetch failed. Fetch manually or see install instructions.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span> <span class="o">=</span> <span class="n">SPK</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">spkpath</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;All ephemeride data from Vallado Appendix D.4</span>
<span class="sd">            Values are: a = sma (AU), e = eccentricity, I = inclination (deg),</span>
<span class="sd">                        O = long. ascending node (deg), w = long. perihelion (deg),</span>
<span class="sd">                        lM = mean longitude (deg)</span>
<span class="sd">            </span>
<span class="sd">            &quot;&quot;&quot;</span>
            
            <span class="c1"># store ephemerides data in heliocentric true ecliptic frame</span>
            <span class="n">a</span> <span class="o">=</span> <span class="mf">0.387098310</span>
            <span class="n">e</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.20563175</span><span class="p">,</span> <span class="mf">0.000020406</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0000000284</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00000000017</span><span class="p">]</span>
            <span class="n">I</span> <span class="o">=</span> <span class="p">[</span><span class="mf">7.004986</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0059516</span><span class="p">,</span> <span class="mf">0.00000081</span><span class="p">,</span> <span class="mf">0.000000041</span><span class="p">]</span>
            <span class="n">O</span> <span class="o">=</span> <span class="p">[</span><span class="mf">48.330893</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1254229</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00008833</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000000196</span><span class="p">]</span>
            <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="mf">77.456119</span><span class="p">,</span> <span class="mf">0.1588643</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00001343</span><span class="p">,</span> <span class="mf">0.000000039</span><span class="p">]</span>
            <span class="n">lM</span> <span class="o">=</span> <span class="p">[</span><span class="mf">252.250906</span><span class="p">,</span> <span class="mf">149472.6746358</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00000535</span><span class="p">,</span> <span class="mf">0.000000002</span><span class="p">]</span>
            <span class="n">Mercury</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SolarEph</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">lM</span><span class="p">)</span>
            
            <span class="n">a</span> <span class="o">=</span> <span class="mf">0.723329820</span>
            <span class="n">e</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.00677188</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000047766</span><span class="p">,</span> <span class="mf">0.0000000975</span><span class="p">,</span> <span class="mf">0.00000000044</span><span class="p">]</span>
            <span class="n">I</span> <span class="o">=</span> <span class="p">[</span><span class="mf">3.394662</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0008568</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00003244</span><span class="p">,</span> <span class="mf">0.000000010</span><span class="p">]</span>
            <span class="n">O</span> <span class="o">=</span> <span class="p">[</span><span class="mf">76.679920</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2780080</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00014256</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000000198</span><span class="p">]</span>
            <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="mf">131.563707</span><span class="p">,</span> <span class="mf">0.0048646</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00138232</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000005332</span><span class="p">]</span>
            <span class="n">lM</span> <span class="o">=</span> <span class="p">[</span><span class="mf">181.979801</span><span class="p">,</span> <span class="mf">58517.8156760</span><span class="p">,</span> <span class="mf">0.00000165</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000000002</span><span class="p">]</span>
            <span class="n">Venus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SolarEph</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">lM</span><span class="p">)</span>
            
            <span class="n">a</span> <span class="o">=</span> <span class="mf">1.000001018</span>
            <span class="n">e</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01670862</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000042037</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0000001236</span><span class="p">,</span> <span class="mf">0.00000000004</span><span class="p">]</span>
            <span class="n">I</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.0130546</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00000931</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000000034</span><span class="p">]</span>
            <span class="n">O</span> <span class="o">=</span> <span class="p">[</span><span class="mf">174.873174</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2410908</span><span class="p">,</span> <span class="mf">0.00004067</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000001327</span><span class="p">]</span>
            <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="mf">102.937348</span><span class="p">,</span> <span class="mf">0.3225557</span><span class="p">,</span> <span class="mf">0.00015026</span><span class="p">,</span> <span class="mf">0.000000478</span><span class="p">]</span>
            <span class="n">lM</span> <span class="o">=</span> <span class="p">[</span><span class="mf">100.466449</span><span class="p">,</span> <span class="mf">35999.3728519</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00000568</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span>
            <span class="n">Earth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SolarEph</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">lM</span><span class="p">)</span>
            
            <span class="n">a</span> <span class="o">=</span> <span class="mf">1.523679342</span>
            <span class="n">e</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.09340062</span><span class="p">,</span> <span class="mf">0.000090483</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0000000806</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00000000035</span><span class="p">]</span>
            <span class="n">I</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.849726</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0081479</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00002255</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000000027</span><span class="p">]</span>
            <span class="n">O</span> <span class="o">=</span> <span class="p">[</span><span class="mf">49.558093</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2949846</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00063993</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000002143</span><span class="p">]</span>
            <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="mf">336.060234</span><span class="p">,</span> <span class="mf">0.4438898</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00017321</span><span class="p">,</span> <span class="mf">0.000000300</span><span class="p">]</span>
            <span class="n">lM</span> <span class="o">=</span> <span class="p">[</span><span class="mf">355.433275</span><span class="p">,</span> <span class="mf">19140.2993313</span><span class="p">,</span> <span class="mf">0.00000261</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000000003</span><span class="p">]</span>
            <span class="n">Mars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SolarEph</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">lM</span><span class="p">)</span>
            
            <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mf">5.202603191</span><span class="p">,</span> <span class="mf">0.0000001913</span><span class="p">]</span>
            <span class="n">e</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.04849485</span><span class="p">,</span> <span class="mf">0.000163244</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0000004719</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00000000197</span><span class="p">]</span>
            <span class="n">I</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.303270</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0019872</span><span class="p">,</span> <span class="mf">0.00003318</span><span class="p">,</span> <span class="mf">0.000000092</span><span class="p">]</span>
            <span class="n">O</span> <span class="o">=</span> <span class="p">[</span><span class="mf">100.464441</span><span class="p">,</span> <span class="mf">0.1766828</span><span class="p">,</span> <span class="mf">0.00090387</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000007032</span><span class="p">]</span>
            <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="mf">14.331309</span><span class="p">,</span> <span class="mf">0.2155525</span><span class="p">,</span> <span class="mf">0.00072252</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000004590</span><span class="p">]</span>
            <span class="n">lM</span> <span class="o">=</span> <span class="p">[</span><span class="mf">34.351484</span><span class="p">,</span> <span class="mf">3034.9056746</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00008501</span><span class="p">,</span> <span class="mf">0.000000004</span><span class="p">]</span>
            <span class="n">Jupiter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SolarEph</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">lM</span><span class="p">)</span>
            
            <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mf">9.554909596</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0000021389</span><span class="p">]</span>
            <span class="n">e</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.05550862</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000346818</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0000006456</span><span class="p">,</span> <span class="mf">0.00000000338</span><span class="p">]</span>
            <span class="n">I</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.488878</span><span class="p">,</span> <span class="mf">0.0025515</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00004903</span><span class="p">,</span> <span class="mf">0.000000018</span><span class="p">]</span>
            <span class="n">O</span> <span class="o">=</span> <span class="p">[</span><span class="mf">113.665524</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2566649</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00018345</span><span class="p">,</span> <span class="mf">0.000000357</span><span class="p">]</span>
            <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="mf">93.056787</span><span class="p">,</span> <span class="mf">0.5665496</span><span class="p">,</span> <span class="mf">0.00052809</span><span class="p">,</span> <span class="mf">0.000004882</span><span class="p">]</span>
            <span class="n">lM</span> <span class="o">=</span> <span class="p">[</span><span class="mf">50.077471</span><span class="p">,</span> <span class="mf">1222.1137943</span><span class="p">,</span> <span class="mf">0.00021004</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000000019</span><span class="p">]</span>
            <span class="n">Saturn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SolarEph</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">lM</span><span class="p">)</span>
            
            <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mf">19.218446062</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0000000372</span><span class="p">,</span> <span class="mf">0.00000000098</span><span class="p">]</span>
            <span class="n">e</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.04629590</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000027337</span><span class="p">,</span> <span class="mf">0.0000000790</span><span class="p">,</span> <span class="mf">0.00000000025</span><span class="p">]</span>
            <span class="n">I</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.773196</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0016869</span><span class="p">,</span> <span class="mf">0.00000349</span><span class="p">,</span> <span class="mf">0.000000016</span><span class="p">]</span>
            <span class="n">O</span> <span class="o">=</span> <span class="p">[</span><span class="mf">74.005947</span><span class="p">,</span> <span class="mf">0.0741461</span><span class="p">,</span> <span class="mf">0.00040540</span><span class="p">,</span> <span class="mf">0.000000104</span><span class="p">]</span>
            <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="mf">173.005159</span><span class="p">,</span> <span class="mf">0.0893206</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00009470</span><span class="p">,</span> <span class="mf">0.000000413</span><span class="p">]</span>
            <span class="n">lM</span> <span class="o">=</span> <span class="p">[</span><span class="mf">314.055005</span><span class="p">,</span> <span class="mf">428.4669983</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00000486</span><span class="p">,</span> <span class="mf">0.000000006</span><span class="p">]</span>
            <span class="n">Uranus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SolarEph</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">lM</span><span class="p">)</span>
            
            <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mf">30.110386869</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0000001663</span><span class="p">,</span> <span class="mf">0.00000000069</span><span class="p">]</span>
            <span class="n">e</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.00898809</span><span class="p">,</span> <span class="mf">0.000006408</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0000000008</span><span class="p">]</span>
            <span class="n">I</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.769952</span><span class="p">,</span> <span class="mf">0.0002257</span><span class="p">,</span> <span class="mf">0.00000023</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000000000</span><span class="p">]</span>
            <span class="n">O</span> <span class="o">=</span> <span class="p">[</span><span class="mf">131.784057</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0061651</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00000219</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000000078</span><span class="p">]</span>
            <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="mf">48.123691</span><span class="p">,</span> <span class="mf">0.0291587</span><span class="p">,</span> <span class="mf">0.00007051</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span>
            <span class="n">lM</span> <span class="o">=</span> <span class="p">[</span><span class="mf">304.348665</span><span class="p">,</span> <span class="mf">218.4862002</span><span class="p">,</span> <span class="mf">0.00000059</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000000002</span><span class="p">]</span>
            <span class="n">Neptune</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SolarEph</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">lM</span><span class="p">)</span>
            
            <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mf">39.48168677</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00076912</span><span class="p">]</span>
            <span class="n">e</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.24880766</span><span class="p">,</span> <span class="mf">0.00006465</span><span class="p">]</span>
            <span class="n">I</span> <span class="o">=</span> <span class="p">[</span><span class="mf">17.14175</span><span class="p">,</span> <span class="mf">0.003075</span><span class="p">]</span>
            <span class="n">O</span> <span class="o">=</span> <span class="p">[</span><span class="mf">110.30347</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01036944</span><span class="p">]</span>
            <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="mf">224.06676</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03673611</span><span class="p">]</span>
            <span class="n">lM</span> <span class="o">=</span> <span class="p">[</span><span class="mf">238.92881</span><span class="p">,</span> <span class="mf">145.2078</span><span class="p">]</span>
            <span class="n">Pluto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SolarEph</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">lM</span><span class="p">)</span>
            
            <span class="c1"># store all as dictionary:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">planets</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Mercury&#39;</span><span class="p">:</span> <span class="n">Mercury</span><span class="p">,</span>
                            <span class="s1">&#39;Venus&#39;</span><span class="p">:</span> <span class="n">Venus</span><span class="p">,</span>
                            <span class="s1">&#39;Earth&#39;</span><span class="p">:</span> <span class="n">Earth</span><span class="p">,</span>
                            <span class="s1">&#39;Mars&#39;</span><span class="p">:</span> <span class="n">Mars</span><span class="p">,</span>
                            <span class="s1">&#39;Jupiter&#39;</span><span class="p">:</span> <span class="n">Jupiter</span><span class="p">,</span>
                            <span class="s1">&#39;Saturn&#39;</span><span class="p">:</span> <span class="n">Saturn</span><span class="p">,</span>
                            <span class="s1">&#39;Uranus&#39;</span><span class="p">:</span> <span class="n">Uranus</span><span class="p">,</span>
                            <span class="s1">&#39;Neptune&#39;</span><span class="p">:</span> <span class="n">Neptune</span><span class="p">,</span>
                            <span class="s1">&#39;Pluto&#39;</span><span class="p">:</span> <span class="n">Pluto</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;String representation of the Observatory object</span>
<span class="sd">        </span>
<span class="sd">        When the command &#39;print&#39; is used on the Observatory object, this method</span>
<span class="sd">        will print the attribute values contained in the object</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">att</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">)))</span>
        
        <span class="k">return</span> <span class="s1">&#39;Observatory class object attributes&#39;</span>

<div class="viewcode-block" id="Observatory.equat2eclip"><a class="viewcode-back" href="../../../EXOSIMS.Prototypes.html#EXOSIMS.Prototypes.Observatory.Observatory.equat2eclip">[docs]</a>    <span class="k">def</span> <span class="nf">equat2eclip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r_equat</span><span class="p">,</span> <span class="n">currentTime</span><span class="p">,</span> <span class="n">rotsign</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Rotates heliocentric coordinates from equatorial to ecliptic frame.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            r_equat (astropy Quantity nx3 array):</span>
<span class="sd">                Positions vector in heliocentric equatorial frame in units of AU</span>
<span class="sd">            currentTime (astropy Time array):</span>
<span class="sd">                Current absolute mission time in MJD</span>
<span class="sd">            rotsign (integer):</span>
<span class="sd">                Optional flag, default 1, set -1 to reverse the rotation</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            r_eclip (astropy Quantity nx3 array):</span>
<span class="sd">                Positions vector in heliocentric ecliptic frame in units of AU</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># check size of arrays</span>
        <span class="k">assert</span> <span class="n">currentTime</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">currentTime</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">r_equat</span><span class="p">),</span> \
                <span class="s2">&quot;If multiple times and positions, currentTime and r_equat sizes must match&quot;</span>
        <span class="c1"># find Julian centuries from J2000</span>
        <span class="n">TDB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cent</span><span class="p">(</span><span class="n">currentTime</span><span class="p">)</span>
        <span class="c1"># find obliquity of the ecliptic</span>
        <span class="n">obe</span> <span class="o">=</span> <span class="n">rotsign</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obe</span><span class="p">(</span><span class="n">TDB</span><span class="p">)),</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># positions vector in heliocentric ecliptic frame</span>
        <span class="k">if</span> <span class="n">currentTime</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">r_eclip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rot</span><span class="p">(</span><span class="n">obe</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> 
                <span class="n">r_equat</span><span class="p">[</span><span class="n">x</span><span class="p">,:]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;AU&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r_equat</span><span class="p">))])</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">AU</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r_eclip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rot</span><span class="p">(</span><span class="n">obe</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> 
                <span class="n">r_equat</span><span class="p">[</span><span class="n">x</span><span class="p">,:]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;AU&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r_equat</span><span class="p">))])</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">AU</span>
        </div>
        <span class="k">return</span> <span class="n">r_eclip</span>

<div class="viewcode-block" id="Observatory.eclip2equat"><a class="viewcode-back" href="../../../EXOSIMS.Prototypes.html#EXOSIMS.Prototypes.Observatory.Observatory.eclip2equat">[docs]</a>    <span class="k">def</span> <span class="nf">eclip2equat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r_eclip</span><span class="p">,</span> <span class="n">currentTime</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Rotates heliocentric coordinates from ecliptic to equatorial frame.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            r_eclip (astropy Quantity nx3 array):</span>
<span class="sd">                Positions vector in heliocentric ecliptic frame in units of AU</span>
<span class="sd">            currentTime (astropy Time array):</span>
<span class="sd">                Current absolute mission time in MJD</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            r_equat (astropy Quantity nx3 array):</span>
<span class="sd">                Positions vector in heliocentric equatorial frame in units of AU</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">r_equat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">equat2eclip</span><span class="p">(</span><span class="n">r_eclip</span><span class="p">,</span> <span class="n">currentTime</span><span class="p">,</span> <span class="n">rotsign</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        </div>
        <span class="k">return</span> <span class="n">r_equat</span>

<div class="viewcode-block" id="Observatory.orbit"><a class="viewcode-back" href="../../../EXOSIMS.Prototypes.html#EXOSIMS.Prototypes.Observatory.Observatory.orbit">[docs]</a>    <span class="k">def</span> <span class="nf">orbit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currentTime</span><span class="p">,</span> <span class="n">eclip</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Finds observatory orbit positions vector in heliocentric equatorial (default)</span>
<span class="sd">        or ecliptic frame for current time (MJD).</span>
<span class="sd">        </span>
<span class="sd">        This method returns the telescope geosynchronous circular orbit position vector.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            currentTime (astropy Time array):</span>
<span class="sd">                Current absolute mission time in MJD</span>
<span class="sd">            eclip (boolean):</span>
<span class="sd">                Boolean used to switch to heliocentric ecliptic frame. Defaults to </span>
<span class="sd">                False, corresponding to heliocentric equatorial frame.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            r_obs (astropy Quantity nx3 array):</span>
<span class="sd">                Observatory orbit positions vector in heliocentric equatorial (default)</span>
<span class="sd">                or ecliptic frame in units of AU</span>
<span class="sd">        </span>
<span class="sd">        Note: Use eclip=True to get ecliptic coordinates.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">mjdtime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">currentTime</span><span class="o">.</span><span class="n">mjd</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># modified julian day time</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">mjdtime</span> <span class="o">%</span> <span class="mi">1</span>                     <span class="c1"># gives percent of day</span>
        <span class="n">f</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>                        <span class="c1"># orbital frequency (2*pi/sideral day)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="mf">42164.</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">km</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;AU&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>    <span class="c1"># orbital height (convert from km to AU)</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">28.5</span><span class="p">)</span>                <span class="c1"># orbital inclination in degrees</span>
        <span class="n">O</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">228.</span><span class="p">)</span>                <span class="c1"># right ascension of the ascending node</span>
        
        <span class="c1"># observatory positions vector wrt Earth in orbital plane</span>
        <span class="n">r_orb</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">f</span><span class="o">*</span><span class="n">t</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">f</span><span class="o">*</span><span class="n">t</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">size</span><span class="p">)])</span>
        <span class="c1"># observatory positions vector wrt Earth in equatorial frame</span>
        <span class="n">r_obs_earth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rot</span><span class="p">(</span><span class="o">-</span><span class="n">O</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">rot</span><span class="p">(</span><span class="o">-</span><span class="n">I</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">r_orb</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">AU</span>
        <span class="c1"># Earth positions vector in heliocentric equatorial frame</span>
        <span class="n">r_earth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solarSystem_body_position</span><span class="p">(</span><span class="n">currentTime</span><span class="p">,</span> <span class="s1">&#39;Earth&#39;</span><span class="p">)</span>
        <span class="c1"># observatory positions vector in heliocentric equatorial frame</span>
        <span class="n">r_obs</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_obs_earth</span> <span class="o">+</span> <span class="n">r_earth</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;AU&#39;</span><span class="p">)</span>
        
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">r_obs</span><span class="p">)),</span> \
                <span class="s2">&quot;Observatory positions vector r_obs has infinite value.&quot;</span>
        
        <span class="k">if</span> <span class="n">eclip</span><span class="p">:</span>
            <span class="c1"># observatory positions vector in heliocentric ecliptic frame</span>
            <span class="n">r_obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">equat2eclip</span><span class="p">(</span><span class="n">r_obs</span><span class="p">,</span> <span class="n">currentTime</span><span class="p">)</span>
        </div>
        <span class="k">return</span> <span class="n">r_obs</span>

<div class="viewcode-block" id="Observatory.keepout"><a class="viewcode-back" href="../../../EXOSIMS.Prototypes.html#EXOSIMS.Prototypes.Observatory.Observatory.keepout">[docs]</a>    <span class="k">def</span> <span class="nf">keepout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TL</span><span class="p">,</span> <span class="n">sInds</span><span class="p">,</span> <span class="n">currentTime</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">returnExtra</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Finds keepout Boolean values for stars of interest.</span>
<span class="sd">        </span>
<span class="sd">        This method returns the keepout Boolean values for stars of interest, where</span>
<span class="sd">        True is an observable star.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            TL (TargetList module):</span>
<span class="sd">                TargetList class object</span>
<span class="sd">            sInds (integer ndarray):</span>
<span class="sd">                Integer indices of the stars of interest</span>
<span class="sd">            currentTime (astropy Time array):</span>
<span class="sd">                Current absolute mission time in MJD</span>
<span class="sd">            mode (dict):</span>
<span class="sd">                Selected observing mode</span>
<span class="sd">            returnExtra (boolean):</span>
<span class="sd">                Optional flag, default False, set True to return additional rates </span>
<span class="sd">                for validation</span>
<span class="sd">                </span>
<span class="sd">        Returns:</span>
<span class="sd">            kogood (boolean ndarray):</span>
<span class="sd">                True is a target unobstructed and observable, and False is a </span>
<span class="sd">                target unobservable due to obstructions in the keepout zone.</span>
<span class="sd">        </span>
<span class="sd">        Note: If multiple times and targets, currentTime and sInds sizes must match.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># if multiple time values, check they are different otherwise reduce to scalar</span>
        <span class="k">if</span> <span class="n">currentTime</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">currentTime</span> <span class="o">==</span> <span class="n">currentTime</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">currentTime</span> <span class="o">=</span> <span class="n">currentTime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># cast sInds to array</span>
        <span class="n">sInds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sInds</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># get all array sizes</span>
        <span class="n">nStars</span> <span class="o">=</span> <span class="n">sInds</span><span class="o">.</span><span class="n">size</span>
        <span class="n">nTimes</span> <span class="o">=</span> <span class="n">currentTime</span><span class="o">.</span><span class="n">size</span>
        <span class="n">nBodies</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="k">assert</span> <span class="n">nStars</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">nTimes</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">nTimes</span> <span class="o">==</span> <span class="n">nStars</span><span class="p">,</span> \
                <span class="s2">&quot;If multiple times and targets, currentTime and sInds sizes must match&quot;</span>
        
        <span class="c1"># observatory positions vector in heliocentric equatorial frame</span>
        <span class="n">r_obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orbit</span><span class="p">(</span><span class="n">currentTime</span><span class="p">)</span>
        <span class="c1"># traget star positions vector in heliocentric equatorial frame</span>
        <span class="n">r_targ</span> <span class="o">=</span> <span class="n">TL</span><span class="o">.</span><span class="n">starprop</span><span class="p">(</span><span class="n">sInds</span><span class="p">,</span> <span class="n">currentTime</span><span class="p">)</span>
        <span class="c1"># body positions vector in heliocentric equatorial frame</span>
        <span class="n">r_body</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solarSystem_body_position</span><span class="p">(</span><span class="n">currentTime</span><span class="p">,</span> <span class="s1">&#39;Sun&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;AU&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solarSystem_body_position</span><span class="p">(</span><span class="n">currentTime</span><span class="p">,</span> <span class="s1">&#39;Moon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;AU&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solarSystem_body_position</span><span class="p">(</span><span class="n">currentTime</span><span class="p">,</span> <span class="s1">&#39;Earth&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;AU&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solarSystem_body_position</span><span class="p">(</span><span class="n">currentTime</span><span class="p">,</span> <span class="s1">&#39;Mercury&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;AU&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solarSystem_body_position</span><span class="p">(</span><span class="n">currentTime</span><span class="p">,</span> <span class="s1">&#39;Venus&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;AU&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solarSystem_body_position</span><span class="p">(</span><span class="n">currentTime</span><span class="p">,</span> <span class="s1">&#39;Mars&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;AU&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solarSystem_body_position</span><span class="p">(</span><span class="n">currentTime</span><span class="p">,</span> <span class="s1">&#39;Jupiter&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;AU&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solarSystem_body_position</span><span class="p">(</span><span class="n">currentTime</span><span class="p">,</span> <span class="s1">&#39;Saturn&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;AU&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solarSystem_body_position</span><span class="p">(</span><span class="n">currentTime</span><span class="p">,</span> <span class="s1">&#39;Uranus&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;AU&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solarSystem_body_position</span><span class="p">(</span><span class="n">currentTime</span><span class="p">,</span> <span class="s1">&#39;Neptune&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;AU&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">solarSystem_body_position</span><span class="p">(</span><span class="n">currentTime</span><span class="p">,</span> <span class="s1">&#39;Pluto&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;AU&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">])</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">AU</span>
        <span class="c1"># position vectors wrt spacecraft</span>
        <span class="n">r_targ</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_targ</span> <span class="o">-</span> <span class="n">r_obs</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;pc&#39;</span><span class="p">)</span>
        <span class="n">r_body</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_body</span> <span class="o">-</span> <span class="n">r_obs</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;AU&#39;</span><span class="p">)</span>
        <span class="c1"># unit vectors wrt spacecraft</span>
        <span class="n">u_targ</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_targ</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">T</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r_targ</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="n">u_body</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_body</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">T</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r_body</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        
        <span class="c1"># create koangles for all bodies, set by telescope minimum keepout angle for </span>
        <span class="c1"># brighter objects (Sun, Moon, Earth) and defaults to 1 degree for other bodies</span>
        <span class="n">koangles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">nBodies</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">koAngleMin</span>
        <span class="c1"># allow Moon, Earth to be set individually (default to koAngleMin)</span>
        <span class="n">koangles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">koAngleMinMoon</span> 
        <span class="n">koangles</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">koAngleMinEarth</span>
        <span class="c1"># keepout angle for small bodies (other planets)</span>
        <span class="n">koangles</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">koAngleSmall</span>
        
        <span class="c1"># find angles and make angle comparisons to build kogood array:</span>
        <span class="c1"># if bright objects have an angle with the target vector less than koangle </span>
        <span class="c1"># (e.g. pi/4) they are in the field of view and the target star may not be</span>
        <span class="c1"># observed, thus ko associated with this target becomes False</span>
        <span class="n">nkogood</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">nStars</span><span class="p">,</span> <span class="n">nTimes</span><span class="p">)</span>
        <span class="n">kogood</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span><span class="p">]</span><span class="o">*</span><span class="n">nkogood</span><span class="p">)</span>
        <span class="n">culprit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">nkogood</span><span class="p">,</span> <span class="n">nBodies</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">nkogood</span><span class="p">):</span>
            <span class="n">u_b</span> <span class="o">=</span> <span class="n">u_body</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,:]</span> <span class="k">if</span> <span class="n">nTimes</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">u_body</span><span class="p">[:,</span><span class="n">i</span><span class="p">,:]</span>
            <span class="n">u_t</span> <span class="o">=</span> <span class="n">u_targ</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="k">if</span> <span class="n">nStars</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">u_targ</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span>
            <span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">u_b</span><span class="p">,</span> <span class="n">u_t</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">rad</span>
            <span class="n">culprit</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">angles</span> <span class="o">&lt;</span> <span class="n">koangles</span><span class="p">)</span>
            <span class="c1"># if this mode has an occulter, check maximum keepout angle for the Sun</span>
            <span class="k">if</span> <span class="n">mode</span><span class="p">[</span><span class="s1">&#39;syst&#39;</span><span class="p">][</span><span class="s1">&#39;occulter&#39;</span><span class="p">]:</span>
                <span class="n">culprit</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">culprit</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="p">(</span><span class="n">angles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">koAngleMax</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">culprit</span><span class="p">[</span><span class="n">i</span><span class="p">,:]):</span>
                <span class="n">kogood</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="c1"># check to make sure all elements in kogood are Boolean</span>
        <span class="n">trues</span> <span class="o">=</span> <span class="p">[</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">)</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">kogood</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">trues</span><span class="p">),</span> <span class="s2">&quot;An element of kogood is not Boolean&quot;</span>
        
        <span class="k">if</span> <span class="n">returnExtra</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">kogood</span><span class="p">,</span> <span class="n">r_body</span><span class="p">,</span> <span class="n">r_targ</span><span class="p">,</span> <span class="n">culprit</span><span class="p">,</span> <span class="n">koangles</span>
        <span class="k">else</span><span class="p">:</span></div>
            <span class="k">return</span> <span class="n">kogood</span>

<div class="viewcode-block" id="Observatory.solarSystem_body_position"><a class="viewcode-back" href="../../../EXOSIMS.Prototypes.html#EXOSIMS.Prototypes.Observatory.Observatory.solarSystem_body_position">[docs]</a>    <span class="k">def</span> <span class="nf">solarSystem_body_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currentTime</span><span class="p">,</span> <span class="n">bodyname</span><span class="p">,</span> <span class="n">eclip</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Finds solar system body positions vector in heliocentric equatorial (default)</span>
<span class="sd">        or ecliptic frame for current time (MJD).</span>
<span class="sd">        </span>
<span class="sd">        This passes all arguments to one of spk_body or keplerplanet, depending</span>
<span class="sd">        on the value of self.havejplephem.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            currentTime (astropy Time array):</span>
<span class="sd">                Current absolute mission time in MJD</span>
<span class="sd">            bodyname (string):</span>
<span class="sd">                Solar system object name</span>
<span class="sd">            eclip (boolean):</span>
<span class="sd">                Boolean used to switch to heliocentric ecliptic frame. Defaults to </span>
<span class="sd">                False, corresponding to heliocentric equatorial frame.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            r_body (astropy Quantity nx3 array):</span>
<span class="sd">                Solar system body positions in heliocentric equatorial (default)</span>
<span class="sd">                or ecliptic frame in units of AU</span>
<span class="sd">        </span>
<span class="sd">        Note: Use eclip=True to get ecliptic coordinates.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># heliocentric</span>
        <span class="k">if</span> <span class="n">bodyname</span> <span class="o">==</span> <span class="s1">&#39;Sun&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">currentTime</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">AU</span>
        
        <span class="c1"># choose JPL or static ephemerides</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">havejplephem</span><span class="p">:</span>
            <span class="n">r_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spk_body</span><span class="p">(</span><span class="n">currentTime</span><span class="p">,</span> <span class="n">bodyname</span><span class="p">,</span> <span class="n">eclip</span><span class="o">=</span><span class="n">eclip</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;AU&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keplerplanet</span><span class="p">(</span><span class="n">currentTime</span><span class="p">,</span> <span class="n">bodyname</span><span class="p">,</span> <span class="n">eclip</span><span class="o">=</span><span class="n">eclip</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;AU&#39;</span><span class="p">)</span>
        </div>
        <span class="k">return</span> <span class="n">r_body</span>

<div class="viewcode-block" id="Observatory.spk_body"><a class="viewcode-back" href="../../../EXOSIMS.Prototypes.html#EXOSIMS.Prototypes.Observatory.Observatory.spk_body">[docs]</a>    <span class="k">def</span> <span class="nf">spk_body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currentTime</span><span class="p">,</span> <span class="n">bodyname</span><span class="p">,</span> <span class="n">eclip</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Finds solar system body positions vector in heliocentric equatorial (default)</span>
<span class="sd">        or ecliptic frame for current time (MJD).</span>
<span class="sd">        </span>
<span class="sd">        This method uses spice kernel from NAIF to find heliocentric </span>
<span class="sd">        equatorial position vectors for solar system objects.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            currentTime (astropy Time array):</span>
<span class="sd">                Current absolute mission time in MJD</span>
<span class="sd">            bodyname (string):</span>
<span class="sd">                Solar system object name</span>
<span class="sd">            eclip (boolean):</span>
<span class="sd">                Boolean used to switch to heliocentric ecliptic frame. Defaults to </span>
<span class="sd">                False, corresponding to heliocentric equatorial frame.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            r_body (astropy Quantity nx3 array):</span>
<span class="sd">                Solar system body positions in heliocentric equatorial (default)</span>
<span class="sd">                or ecliptic frame in units of AU</span>
<span class="sd">        </span>
<span class="sd">        Note: Use eclip=True to get ecliptic coordinates.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># dictionary of solar system bodies available in spice kernel (in km)</span>
        <span class="n">bodies</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Mercury&#39;</span><span class="p">:</span> <span class="mi">199</span><span class="p">,</span>
                  <span class="s1">&#39;Venus&#39;</span><span class="p">:</span> <span class="mi">299</span><span class="p">,</span>
                  <span class="s1">&#39;Earth&#39;</span><span class="p">:</span> <span class="mi">399</span><span class="p">,</span>
                  <span class="s1">&#39;Mars&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                  <span class="s1">&#39;Jupiter&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
                  <span class="s1">&#39;Saturn&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
                  <span class="s1">&#39;Uranus&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
                  <span class="s1">&#39;Neptune&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
                  <span class="s1">&#39;Pluto&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
                  <span class="s1">&#39;Sun&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                  <span class="s1">&#39;Moon&#39;</span><span class="p">:</span> <span class="mi">301</span><span class="p">}</span>
        <span class="k">assert</span> <span class="n">bodies</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">bodyname</span><span class="p">),</span> \
                 <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is not a recognized body name.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">bodyname</span><span class="p">)</span>
        
        <span class="c1"># julian day time</span>
        <span class="n">jdtime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">currentTime</span><span class="o">.</span><span class="n">jd</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># body positions vector in heliocentric equatorial frame</span>
        <span class="k">if</span> <span class="n">bodies</span><span class="p">[</span><span class="n">bodyname</span><span class="p">]</span> <span class="o">==</span> <span class="mi">199</span><span class="p">:</span>
            <span class="n">r_body</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">jdtime</span><span class="p">)</span> <span class="o">+</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">199</span><span class="p">]</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">jdtime</span><span class="p">)</span> <span class="o">-</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">jdtime</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">bodies</span><span class="p">[</span><span class="n">bodyname</span><span class="p">]</span> <span class="o">==</span> <span class="mi">299</span><span class="p">:</span>
            <span class="n">r_body</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">jdtime</span><span class="p">)</span> <span class="o">+</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">299</span><span class="p">]</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">jdtime</span><span class="p">)</span> <span class="o">-</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">jdtime</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">bodies</span><span class="p">[</span><span class="n">bodyname</span><span class="p">]</span> <span class="o">==</span> <span class="mi">399</span><span class="p">:</span>
            <span class="n">r_body</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">jdtime</span><span class="p">)</span> <span class="o">+</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">399</span><span class="p">]</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">jdtime</span><span class="p">)</span> <span class="o">-</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">jdtime</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">bodies</span><span class="p">[</span><span class="n">bodyname</span><span class="p">]</span> <span class="o">==</span> <span class="mi">301</span><span class="p">:</span>
            <span class="n">r_body</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">jdtime</span><span class="p">)</span> <span class="o">+</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">301</span><span class="p">]</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">jdtime</span><span class="p">)</span> <span class="o">-</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">jdtime</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r_body</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">bodies</span><span class="p">[</span><span class="n">bodyname</span><span class="p">]]</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">jdtime</span><span class="p">)</span> <span class="o">-</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">jdtime</span><span class="p">))</span>
        <span class="c1"># reshape and convert units</span>
        <span class="n">r_body</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_body</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">km</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;AU&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">eclip</span><span class="p">:</span>
            <span class="c1"># body positions vector in heliocentric ecliptic frame</span>
            <span class="n">r_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">equat2eclip</span><span class="p">(</span><span class="n">r_body</span><span class="p">,</span> <span class="n">currentTime</span><span class="p">)</span>
        </div>
        <span class="k">return</span> <span class="n">r_body</span>

<div class="viewcode-block" id="Observatory.keplerplanet"><a class="viewcode-back" href="../../../EXOSIMS.Prototypes.html#EXOSIMS.Prototypes.Observatory.Observatory.keplerplanet">[docs]</a>    <span class="k">def</span> <span class="nf">keplerplanet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currentTime</span><span class="p">,</span> <span class="n">bodyname</span><span class="p">,</span> <span class="n">eclip</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Finds solar system body positions vector in heliocentric equatorial (default)</span>
<span class="sd">        or ecliptic frame for current time (MJD).</span>
<span class="sd">        </span>
<span class="sd">        This method uses algorithms 2 and 10 from Vallado 2013 to find </span>
<span class="sd">        heliocentric equatorial position vectors for solar system objects.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            currentTime (astropy Time array):</span>
<span class="sd">                Current absolute mission time in MJD</span>
<span class="sd">            bodyname (string):</span>
<span class="sd">                Solar system object name</span>
<span class="sd">            eclip (boolean):</span>
<span class="sd">                Boolean used to switch to heliocentric ecliptic frame. Defaults to </span>
<span class="sd">                False, corresponding to heliocentric equatorial frame.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            r_body (astropy Quantity nx3 array):</span>
<span class="sd">                Solar system body positions in heliocentric equatorial (default)</span>
<span class="sd">                or ecliptic frame in units of AU</span>
<span class="sd">        </span>
<span class="sd">        Note: Use eclip=True to get ecliptic coordinates.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Moon positions based on Earth positions</span>
        <span class="k">if</span> <span class="n">bodyname</span> <span class="o">==</span> <span class="s1">&#39;Moon&#39;</span><span class="p">:</span>
            <span class="n">r_Earth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keplerplanet</span><span class="p">(</span><span class="n">currentTime</span><span class="p">,</span> <span class="s1">&#39;Earth&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">r_Earth</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">moon_earth</span><span class="p">(</span><span class="n">currentTime</span><span class="p">)</span>
        
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">planets</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">bodyname</span><span class="p">),</span>\
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is not a recognized body name.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">bodyname</span><span class="p">)</span>
        
        <span class="c1"># find Julian centuries from J2000</span>
        <span class="n">TDB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cent</span><span class="p">(</span><span class="n">currentTime</span><span class="p">)</span>
        <span class="c1"># update ephemerides data (convert sma from km to AU)</span>
        <span class="n">planet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">planets</span><span class="p">[</span><span class="n">bodyname</span><span class="p">]</span> 
        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">propeph</span><span class="p">(</span><span class="n">planet</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">TDB</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">km</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;AU&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
        <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">propeph</span><span class="p">(</span><span class="n">planet</span><span class="o">.</span><span class="n">e</span><span class="p">,</span> <span class="n">TDB</span><span class="p">)</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">propeph</span><span class="p">(</span><span class="n">planet</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="n">TDB</span><span class="p">))</span>
        <span class="n">O</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">propeph</span><span class="p">(</span><span class="n">planet</span><span class="o">.</span><span class="n">O</span><span class="p">,</span> <span class="n">TDB</span><span class="p">))</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">propeph</span><span class="p">(</span><span class="n">planet</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="n">TDB</span><span class="p">))</span>
        <span class="n">lM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">propeph</span><span class="p">(</span><span class="n">planet</span><span class="o">.</span><span class="n">lM</span><span class="p">,</span> <span class="n">TDB</span><span class="p">))</span>
        <span class="c1"># find mean anomaly and argument of perigee</span>
        <span class="n">M</span> <span class="o">=</span> <span class="p">(</span><span class="n">lM</span> <span class="o">-</span> <span class="n">w</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">wp</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="n">O</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="c1"># find eccentric anomaly</span>
        <span class="n">E</span> <span class="o">=</span> <span class="n">eccanom</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">e</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># find true anomaly</span>
        <span class="n">nu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">E</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">E</span><span class="p">)</span> <span class="o">-</span> <span class="n">e</span><span class="p">)</span>
        <span class="c1"># find semiparameter</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># body positions vector in orbital plane</span>
        <span class="n">rx</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">e</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">nu</span><span class="p">))</span>
        <span class="n">ry</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">e</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">nu</span><span class="p">))</span>
        <span class="n">rz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">currentTime</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">r_orb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rx</span><span class="p">,</span><span class="n">ry</span><span class="p">,</span><span class="n">rz</span><span class="p">])</span>
        <span class="c1"># body positions vector in heliocentric ecliptic plane</span>
        <span class="n">r_body</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rot</span><span class="p">(</span><span class="o">-</span><span class="n">O</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="mi">3</span><span class="p">),</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">rot</span><span class="p">(</span><span class="o">-</span><span class="n">I</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rot</span><span class="p">(</span><span class="o">-</span><span class="n">wp</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="mi">3</span><span class="p">),</span> 
                <span class="n">r_orb</span><span class="p">[:,</span><span class="n">x</span><span class="p">]))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">currentTime</span><span class="o">.</span><span class="n">size</span><span class="p">)])</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">AU</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">eclip</span><span class="p">:</span>
            <span class="c1"># body positions vector in heliocentric equatorial frame</span>
            <span class="n">r_body</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eclip2equat</span><span class="p">(</span><span class="n">r_body</span><span class="p">,</span> <span class="n">currentTime</span><span class="p">)</span>
        </div>
        <span class="k">return</span> <span class="n">r_body</span>

<div class="viewcode-block" id="Observatory.moon_earth"><a class="viewcode-back" href="../../../EXOSIMS.Prototypes.html#EXOSIMS.Prototypes.Observatory.Observatory.moon_earth">[docs]</a>    <span class="k">def</span> <span class="nf">moon_earth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currentTime</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Finds geocentric equatorial positions vector for Earth&#39;s moon</span>
<span class="sd">        </span>
<span class="sd">        This method uses Algorithm 31 from Vallado 2013 to find the geocentric</span>
<span class="sd">        equatorial positions vector for Earth&#39;s moon.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            currentTime (astropy Time array):</span>
<span class="sd">                Current absolute mission time in MJD</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            r_moon (astropy Quantity nx3 array):</span>
<span class="sd">                Geocentric equatorial position vector in units of AU</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">TDB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cent</span><span class="p">(</span><span class="n">currentTime</span><span class="p">),</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">la</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">218.32</span> <span class="o">+</span> <span class="mf">481267.8813</span><span class="o">*</span><span class="n">TDB</span> <span class="o">+</span> 
            <span class="mf">6.29</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">134.9</span> <span class="o">+</span> <span class="mf">477198.85</span><span class="o">*</span><span class="n">TDB</span><span class="p">))</span> <span class="o">-</span> 
            <span class="mf">1.27</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">259.2</span> <span class="o">-</span> <span class="mf">413335.38</span><span class="o">*</span><span class="n">TDB</span><span class="p">))</span> <span class="o">+</span> 
            <span class="mf">0.66</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">235.7</span> <span class="o">+</span> <span class="mf">890534.23</span><span class="o">*</span><span class="n">TDB</span><span class="p">))</span> <span class="o">+</span> 
            <span class="mf">0.21</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">269.9</span> <span class="o">+</span> <span class="mf">954397.70</span><span class="o">*</span><span class="n">TDB</span><span class="p">))</span> <span class="o">-</span> 
            <span class="mf">0.19</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">357.5</span> <span class="o">+</span> <span class="mf">35999.05</span><span class="o">*</span><span class="n">TDB</span><span class="p">))</span> <span class="o">-</span> 
            <span class="mf">0.11</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">186.6</span> <span class="o">+</span> <span class="mf">966404.05</span><span class="o">*</span><span class="n">TDB</span><span class="p">)))</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">5.13</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">93.3</span> <span class="o">+</span> <span class="mf">483202.03</span><span class="o">*</span><span class="n">TDB</span><span class="p">))</span> <span class="o">+</span> 
            <span class="mf">0.28</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">228.2</span> <span class="o">+</span> <span class="mf">960400.87</span><span class="o">*</span><span class="n">TDB</span><span class="p">))</span> <span class="o">-</span> 
            <span class="mf">0.28</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">318.3</span> <span class="o">+</span> <span class="mf">6003.18</span><span class="o">*</span><span class="n">TDB</span><span class="p">))</span> <span class="o">-</span> 
            <span class="mf">0.17</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">217.6</span> <span class="o">-</span> <span class="mf">407332.20</span><span class="o">*</span><span class="n">TDB</span><span class="p">)))</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">0.9508</span> <span class="o">+</span> <span class="mf">0.0518</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">134.9</span> <span class="o">+</span> <span class="mf">477198.85</span><span class="o">*</span><span class="n">TDB</span><span class="p">))</span> <span class="o">+</span> 
            <span class="mf">0.0095</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">259.2</span> <span class="o">-</span> <span class="mf">413335.38</span><span class="o">*</span><span class="n">TDB</span><span class="p">))</span> <span class="o">+</span> 
            <span class="mf">0.0078</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">235.7</span> <span class="o">+</span> <span class="mf">890534.23</span><span class="o">*</span><span class="n">TDB</span><span class="p">))</span> <span class="o">+</span> 
            <span class="mf">0.0028</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">269.9</span> <span class="o">+</span> <span class="mf">954397.70</span><span class="o">*</span><span class="n">TDB</span><span class="p">)))</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mf">23.439291</span> <span class="o">-</span> <span class="mf">0.0130042</span><span class="o">*</span><span class="n">TDB</span> <span class="o">-</span> <span class="mf">1.64e-7</span><span class="o">*</span><span class="n">TDB</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">5.04e-7</span><span class="o">*</span><span class="n">TDB</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">P</span><span class="p">)</span><span class="o">*</span><span class="mf">6378.137</span> <span class="c1"># km</span>
        <span class="n">r_moon</span> <span class="o">=</span> <span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">la</span><span class="p">),</span> 
                <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">la</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> 
                <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">la</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)])</span>
        
        <span class="c1"># set format and units</span>
        <span class="n">r_moon</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_moon</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">km</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;AU&#39;</span><span class="p">)</span>
        </div>
        <span class="k">return</span> <span class="n">r_moon</span>

<div class="viewcode-block" id="Observatory.cent"><a class="viewcode-back" href="../../../EXOSIMS.Prototypes.html#EXOSIMS.Prototypes.Observatory.Observatory.cent">[docs]</a>    <span class="k">def</span> <span class="nf">cent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currentTime</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Finds time in Julian centuries since J2000 epoch</span>
<span class="sd">        </span>
<span class="sd">        This quantity is needed for many algorithms from Vallado 2013.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            currentTime (astropy Time array):</span>
<span class="sd">                Current absolute mission time in MJD</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            TDB (float ndarray):</span>
<span class="sd">                time in Julian centuries since the J2000 epoch </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">j2000</span> <span class="o">=</span> <span class="n">Time</span><span class="p">(</span><span class="mf">2000.</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;jyear&#39;</span><span class="p">)</span>
        <span class="n">TDB</span> <span class="o">=</span> <span class="p">(</span><span class="n">currentTime</span><span class="o">.</span><span class="n">jd</span> <span class="o">-</span> <span class="n">j2000</span><span class="o">.</span><span class="n">jd</span><span class="p">)</span><span class="o">/</span><span class="mf">36525.</span>
        </div>
        <span class="k">return</span> <span class="n">TDB</span>

<div class="viewcode-block" id="Observatory.propeph"><a class="viewcode-back" href="../../../EXOSIMS.Prototypes.html#EXOSIMS.Prototypes.Observatory.Observatory.propeph">[docs]</a>    <span class="k">def</span> <span class="nf">propeph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">TDB</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Propagates an ephemeris from Vallado 2013 to current time.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            x (list):</span>
<span class="sd">                ephemeride list (maximum of 4 elements)</span>
<span class="sd">            TDB (float):</span>
<span class="sd">                time in Julian centuries since the J2000 epoch</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            y (float ndarray):</span>
<span class="sd">                ephemeride value at current time</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">q</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">q</span><span class="p">:</span>
                    <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="c1"># propagated ephem</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">TDB</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">TDB</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">TDB</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
        <span class="c1"># cast to array</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        </div>
        <span class="k">return</span> <span class="n">y</span>

<div class="viewcode-block" id="Observatory.rot"><a class="viewcode-back" href="../../../EXOSIMS.Prototypes.html#EXOSIMS.Prototypes.Observatory.Observatory.rot">[docs]</a>    <span class="k">def</span> <span class="nf">rot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">th</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Finds the rotation matrix of angle th about the axis value</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            th (float):</span>
<span class="sd">                Rotation angle in radians</span>
<span class="sd">            axis (int): </span>
<span class="sd">                Integer value denoting rotation axis (1,2, or 3)</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            rot_th (float 3x3 ndarray):</span>
<span class="sd">                Rotation matrix</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">rot_th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> 
                    <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)],</span> 
                    <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)]])</span>
        <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">rot_th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)],</span>
                    <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)]])</span>
        <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">rot_th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">),</span> <span class="mf">0.</span><span class="p">],</span>
                    <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">),</span> <span class="mf">0.</span><span class="p">],</span>
                    <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]])</span>
        </div>
        <span class="k">return</span> <span class="n">rot_th</span>

<div class="viewcode-block" id="Observatory.distForces"><a class="viewcode-back" href="../../../EXOSIMS.Prototypes.html#EXOSIMS.Prototypes.Observatory.Observatory.distForces">[docs]</a>    <span class="k">def</span> <span class="nf">distForces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TL</span><span class="p">,</span> <span class="n">sInd</span><span class="p">,</span> <span class="n">currentTime</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Finds lateral and axial disturbance forces on an occulter </span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            TL (TargetList module):</span>
<span class="sd">                TargetList class object</span>
<span class="sd">            sInd (integer):</span>
<span class="sd">                Integer index of the star of interest</span>
<span class="sd">            currentTime (astropy Time):</span>
<span class="sd">                Current absolute mission time in MJD</span>
<span class="sd">                </span>
<span class="sd">        Returns:</span>
<span class="sd">            dF_lateral (astropy Quantity):</span>
<span class="sd">                Lateral disturbance force in units of N</span>
<span class="sd">            dF_axial (astropy Quantity):</span>
<span class="sd">                Axial disturbance force in units of N</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># get spacecraft position vector</span>
        <span class="n">r_obs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orbit</span><span class="p">(</span><span class="n">currentTime</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># sun -&gt; earth position vector</span>
        <span class="n">r_Es</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solarSystem_body_position</span><span class="p">(</span><span class="n">currentTime</span><span class="p">,</span> <span class="s1">&#39;Earth&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Telescope -&gt; target vector and unit vector</span>
        <span class="n">r_targ</span> <span class="o">=</span> <span class="n">TL</span><span class="o">.</span><span class="n">starprop</span><span class="p">(</span><span class="n">sInd</span><span class="p">,</span> <span class="n">currentTime</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">r_obs</span>
        <span class="n">u_targ</span> <span class="o">=</span> <span class="n">r_targ</span><span class="o">.</span><span class="n">value</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r_targ</span><span class="p">)</span>
        <span class="c1"># sun -&gt; occulter vector</span>
        <span class="n">r_Os</span> <span class="o">=</span> <span class="n">r_obs</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">occulterSep</span><span class="o">*</span><span class="n">u_targ</span>
        <span class="c1"># Earth-Moon barycenter -&gt; spacecraft vectors</span>
        <span class="n">r_TE</span> <span class="o">=</span> <span class="n">r_obs</span> <span class="o">-</span> <span class="n">r_Es</span>
        <span class="n">r_OE</span> <span class="o">=</span> <span class="n">r_Os</span> <span class="o">-</span> <span class="n">r_Es</span>
        <span class="c1"># force on occulter</span>
        <span class="n">Mfactor</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">scMass</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">M_sun</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">G</span>
        <span class="n">F_sO</span> <span class="o">=</span> <span class="n">r_Os</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r_Os</span><span class="p">)</span><span class="o">*</span><span class="n">r_Os</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">Mfactor</span>
        <span class="n">F_EO</span> <span class="o">=</span> <span class="n">r_OE</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r_OE</span><span class="p">)</span><span class="o">*</span><span class="n">r_OE</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">Mfactor</span><span class="o">/</span><span class="mf">328900.56</span>
        <span class="n">F_O</span> <span class="o">=</span> <span class="n">F_sO</span> <span class="o">+</span> <span class="n">F_EO</span>
        <span class="c1"># force on telescope</span>
        <span class="n">Mfactor</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">coMass</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">M_sun</span><span class="o">*</span><span class="n">const</span><span class="o">.</span><span class="n">G</span>
        <span class="n">F_sT</span> <span class="o">=</span> <span class="n">r_obs</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r_obs</span><span class="p">)</span><span class="o">*</span><span class="n">r_obs</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">Mfactor</span>
        <span class="n">F_ET</span> <span class="o">=</span> <span class="n">r_TE</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r_TE</span><span class="p">)</span><span class="o">*</span><span class="n">r_TE</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">Mfactor</span><span class="o">/</span><span class="mf">328900.56</span>
        <span class="n">F_T</span> <span class="o">=</span> <span class="n">F_sT</span> <span class="o">+</span> <span class="n">F_ET</span>
        <span class="c1"># differential forces</span>
        <span class="n">dF</span> <span class="o">=</span> <span class="n">F_O</span> <span class="o">-</span> <span class="n">F_T</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">scMass</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">coMass</span>
        <span class="n">dF_axial</span> <span class="o">=</span> <span class="n">dF</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">u_targ</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">)</span>
        <span class="n">dF_lateral</span> <span class="o">=</span> <span class="p">(</span><span class="n">dF</span> <span class="o">-</span> <span class="n">dF_axial</span><span class="o">*</span><span class="n">u_targ</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">)</span>
        <span class="n">dF_lateral</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">dF_lateral</span><span class="p">)</span><span class="o">*</span><span class="n">dF_lateral</span><span class="o">.</span><span class="n">unit</span>
        <span class="n">dF_axial</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dF_axial</span><span class="p">)</span>
        </div>
        <span class="k">return</span> <span class="n">dF_lateral</span><span class="p">,</span> <span class="n">dF_axial</span>

<div class="viewcode-block" id="Observatory.mass_dec"><a class="viewcode-back" href="../../../EXOSIMS.Prototypes.html#EXOSIMS.Prototypes.Observatory.Observatory.mass_dec">[docs]</a>    <span class="k">def</span> <span class="nf">mass_dec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dF_lateral</span><span class="p">,</span> <span class="n">t_int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns mass_used and deltaV </span>
<span class="sd">        </span>
<span class="sd">        The values returned by this method are used to decrement spacecraft </span>
<span class="sd">        mass for station-keeping.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            dF_lateral (astropy Quantity):</span>
<span class="sd">                Lateral disturbance force in units of N</span>
<span class="sd">            t_int (astropy Quantity):</span>
<span class="sd">                Integration time in units of day</span>
<span class="sd">                </span>
<span class="sd">        Returns:</span>
<span class="sd">            intMdot (astropy Quantity):</span>
<span class="sd">                Mass flow rate in units of kg/s</span>
<span class="sd">            mass_used (astropy Quantity):</span>
<span class="sd">                Mass used in station-keeping units of kg</span>
<span class="sd">            deltaV (astropy Quantity):</span>
<span class="sd">                Change in velocity required for station-keeping in units of km/s</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">intMdot</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">45</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="o">*</span>
                <span class="n">dF_lateral</span><span class="o">/</span><span class="n">const</span><span class="o">.</span><span class="n">g0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">skIsp</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kg/s&#39;</span><span class="p">)</span>
        <span class="n">mass_used</span> <span class="o">=</span> <span class="p">(</span><span class="n">intMdot</span><span class="o">*</span><span class="n">t_int</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kg&#39;</span><span class="p">)</span>
        <span class="n">deltaV</span> <span class="o">=</span> <span class="p">(</span><span class="n">dF_lateral</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">scMass</span><span class="o">*</span><span class="n">t_int</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;km/s&#39;</span><span class="p">)</span>
        </div>
        <span class="k">return</span> <span class="n">intMdot</span><span class="p">,</span> <span class="n">mass_used</span><span class="p">,</span> <span class="n">deltaV</span>
    
<div class="viewcode-block" id="Observatory.mass_dec_sk"><a class="viewcode-back" href="../../../EXOSIMS.Prototypes.html#EXOSIMS.Prototypes.Observatory.Observatory.mass_dec_sk">[docs]</a>    <span class="k">def</span> <span class="nf">mass_dec_sk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">TL</span><span class="p">,</span> <span class="n">sInd</span><span class="p">,</span> <span class="n">currentTime</span><span class="p">,</span> <span class="n">t_int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns mass_used, deltaV and disturbance forces</span>
<span class="sd">        </span>
<span class="sd">        This method calculates all values needed to decrement spacecraft mass</span>
<span class="sd">        for station-keeping.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            TL (TargetList module):</span>
<span class="sd">                TargetList class object</span>
<span class="sd">            sInd (integer):</span>
<span class="sd">                Integer index of the star of interest</span>
<span class="sd">            currentTime (astropy Time):</span>
<span class="sd">                Current absolute mission time in MJD</span>
<span class="sd">            t_int (astropy Quantity):</span>
<span class="sd">                Integration time in units of day</span>
<span class="sd">                </span>
<span class="sd">        Returns:</span>
<span class="sd">            dF_lateral (astropy Quantity):</span>
<span class="sd">                Lateral disturbance force in units of N</span>
<span class="sd">            dF_axial (astropy Quantity):</span>
<span class="sd">                Axial disturbance force in units of N</span>
<span class="sd">            intMdot (astropy Quantity):</span>
<span class="sd">                Mass flow rate in units of kg/s</span>
<span class="sd">            mass_used (astropy Quantity):</span>
<span class="sd">                Mass used in station-keeping units of kg</span>
<span class="sd">            deltaV (astropy Quantity):</span>
<span class="sd">                Change in velocity required for station-keeping in units of km/s</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">dF_lateral</span><span class="p">,</span> <span class="n">dF_axial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distForces</span><span class="p">(</span><span class="n">TL</span><span class="p">,</span> <span class="n">sInd</span><span class="p">,</span> <span class="n">currentTime</span><span class="p">)</span>
        <span class="n">intMdot</span><span class="p">,</span> <span class="n">mass_used</span><span class="p">,</span> <span class="n">deltaV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass_dec</span><span class="p">(</span><span class="n">dF_lateral</span><span class="p">,</span> <span class="n">t_int</span><span class="p">)</span>
        </div>
        <span class="k">return</span> <span class="n">dF_lateral</span><span class="p">,</span> <span class="n">dF_axial</span><span class="p">,</span> <span class="n">intMdot</span><span class="p">,</span> <span class="n">mass_used</span><span class="p">,</span> <span class="n">deltaV</span>
    
<div class="viewcode-block" id="Observatory.calculate_dV"><a class="viewcode-back" href="../../../EXOSIMS.Prototypes.html#EXOSIMS.Prototypes.Observatory.Observatory.calculate_dV">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_dV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">TL</span><span class="p">,</span><span class="n">nA</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">tA</span><span class="p">):</span>  
        <span class="sd">&quot;&quot;&quot;Finds the change in velocity needed to transfer to a new star line of sight</span>
<span class="sd">        </span>
<span class="sd">        This method sums the total delta-V needed to transfer from one star</span>
<span class="sd">        line of sight to another. It determines the change in velocity to move from</span>
<span class="sd">        one station-keeping orbit to a transfer orbit at the current time, then from</span>
<span class="sd">        the transfer orbit to the next station-keeping orbit at currentTime + dt.</span>
<span class="sd">        Station-keeping orbits are modeled as discrete boundary value problems.</span>
<span class="sd">        This method can handle multiple indeces for the next target stars and calculates</span>
<span class="sd">        the dVs of each trajectory from the same starting star.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            dt (float 1x1 ndarray):</span>
<span class="sd">                Number of days corresponding to starshade slew time</span>
<span class="sd">            TL (float 1x3 ndarray):</span>
<span class="sd">                TargetList class object</span>
<span class="sd">            nA (integer):</span>
<span class="sd">                Integer index of the current star of interest</span>
<span class="sd">            N  (integer):</span>
<span class="sd">                Integer index of the next star(s) of interest</span>
<span class="sd">            tA (astropy Time array):</span>
<span class="sd">                Current absolute mission time in MJD</span>
<span class="sd">                </span>
<span class="sd">        Returns:</span>
<span class="sd">            dV (float nx6 ndarray):</span>
<span class="sd">                State vectors in rotating frame in normalized units</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
        </div>
        <span class="k">return</span> <span class="n">dV</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">m</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">s</span>    
        
<div class="viewcode-block" id="Observatory.calculate_slewTimes"><a class="viewcode-back" href="../../../EXOSIMS.Prototypes.html#EXOSIMS.Prototypes.Observatory.Observatory.calculate_slewTimes">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_slewTimes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">TL</span><span class="p">,</span><span class="n">old_sInd</span><span class="p">,</span><span class="n">sInds</span><span class="p">,</span><span class="n">currentTime</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Finds slew times and separation angles between target stars</span>
<span class="sd">        </span>
<span class="sd">        This method determines the slew times of an occulter spacecraft needed</span>
<span class="sd">        to transfer from one star&#39;s line of sight to all others in a given </span>
<span class="sd">        target list.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            TL (TargetList module):</span>
<span class="sd">                TargetList class object</span>
<span class="sd">            old_sInd (integer):</span>
<span class="sd">                Integer index of the most recently observed star</span>
<span class="sd">            sInds (integer):</span>
<span class="sd">                Integer indeces of the star of interest</span>
<span class="sd">            currentTime (astropy Time):</span>
<span class="sd">                Current absolute mission time in MJD</span>
<span class="sd">                </span>
<span class="sd">        Returns:</span>
<span class="sd">            sd (astropy Quantity):</span>
<span class="sd">                Angular separation between stars in rad</span>
<span class="sd">            slewTimes (astropy Quantity):</span>
<span class="sd">                Time to transfer to new star line of sight in units of days</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">ao</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thrust</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">scMass</span>
        <span class="n">slewTime_fac</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">occulterSep</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ao</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defburnPortion</span><span class="o">/</span><span class="mf">2.</span> <span class="o">-</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">defburnPortion</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mf">4.</span><span class="p">))</span><span class="o">.</span><span class="n">decompose</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;d2&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">old_sInd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span><span class="o">*</span><span class="n">TL</span><span class="o">.</span><span class="n">nStars</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">rad</span>
            <span class="n">slewTimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">TL</span><span class="o">.</span><span class="n">nStars</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">d</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># position vector of previous target star</span>
            <span class="n">r_old</span> <span class="o">=</span> <span class="n">TL</span><span class="o">.</span><span class="n">starprop</span><span class="p">(</span><span class="n">old_sInd</span><span class="p">,</span> <span class="n">currentTime</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">u_old</span> <span class="o">=</span> <span class="n">r_old</span><span class="o">.</span><span class="n">value</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r_old</span><span class="p">)</span>
            <span class="c1"># position vector of new target stars</span>
            <span class="n">r_new</span> <span class="o">=</span> <span class="n">TL</span><span class="o">.</span><span class="n">starprop</span><span class="p">(</span><span class="n">sInds</span><span class="p">,</span> <span class="n">currentTime</span><span class="p">)</span>
            <span class="n">u_new</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_new</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">T</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">r_new</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
            <span class="c1"># angle between old and new stars</span>
            <span class="n">sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">u_old</span><span class="p">,</span> <span class="n">u_new</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">rad</span>
            <span class="c1"># calculate slew time</span>
            <span class="n">slewTimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">slewTime_fac</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sd</span><span class="o">/</span><span class="mf">2.</span><span class="p">))</span>
        </div>
        <span class="k">return</span> <span class="n">sd</span><span class="p">,</span><span class="n">slewTimes</span>
    
<div class="viewcode-block" id="Observatory.log_occulterResults"><a class="viewcode-back" href="../../../EXOSIMS.Prototypes.html#EXOSIMS.Prototypes.Observatory.Observatory.log_occulterResults">[docs]</a>    <span class="k">def</span> <span class="nf">log_occulterResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">DRM</span><span class="p">,</span><span class="n">slewTimes</span><span class="p">,</span><span class="n">sInd</span><span class="p">,</span><span class="n">sd</span><span class="p">,</span><span class="n">dV</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates the given DRM to include occulter values and results</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            DRM (dict):</span>
<span class="sd">                Design Reference Mission, contains the results of one complete</span>
<span class="sd">                observation (detection and characterization)</span>
<span class="sd">            slewTimes (astropy Quantity):</span>
<span class="sd">                Time to transfer to new star line of sight in units of days</span>
<span class="sd">            sInd (integer):</span>
<span class="sd">                Integer index of the star of interest</span>
<span class="sd">            sd (astropy Quantity):</span>
<span class="sd">                Angular separation between stars in rad</span>
<span class="sd">            dV (astropy Quantity):</span>
<span class="sd">                Delta-V used to transfer to new star line of sight in units of m/s</span>
<span class="sd">                </span>
<span class="sd">        Returns:</span>
<span class="sd">            DRM (dict):</span>
<span class="sd">                Design Reference Mission, contains the results of one complete</span>
<span class="sd">                observation (detection and characterization)</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">DRM</span><span class="p">[</span><span class="s1">&#39;slew_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">slewTimes</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;day&#39;</span><span class="p">)</span>
        <span class="n">DRM</span><span class="p">[</span><span class="s1">&#39;slew_angle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;deg&#39;</span><span class="p">)</span>
        
        <span class="n">slew_mass_used</span> <span class="o">=</span> <span class="n">slewTimes</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">defburnPortion</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">flowRate</span>
        <span class="n">DRM</span><span class="p">[</span><span class="s1">&#39;slew_dV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">slewTimes</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ao</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">defburnPortion</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m/s&#39;</span><span class="p">)</span>
        <span class="n">DRM</span><span class="p">[</span><span class="s1">&#39;slew_mass_used&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">slew_mass_used</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kg&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scMass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scMass</span> <span class="o">-</span> <span class="n">slew_mass_used</span>
        <span class="n">DRM</span><span class="p">[</span><span class="s1">&#39;scMass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scMass</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;kg&#39;</span><span class="p">)</span>
        </div>
        <span class="k">return</span> <span class="n">DRM</span>

<div class="viewcode-block" id="Observatory.SolarEph"><a class="viewcode-back" href="../../../EXOSIMS.Prototypes.html#EXOSIMS.Prototypes.Observatory.Observatory.SolarEph">[docs]</a>    <span class="k">class</span> <span class="nc">SolarEph</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Solar system ephemerides class </span>
<span class="sd">        </span>
<span class="sd">        This class takes the constants in Appendix D.4 of Vallado as inputs</span>
<span class="sd">        and stores them for use in defining solar system ephemerides at a </span>
<span class="sd">        given time.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            a (list):</span>
<span class="sd">                semimajor axis list (in AU)</span>
<span class="sd">            e (list):</span>
<span class="sd">                eccentricity list</span>
<span class="sd">            I (list):</span>
<span class="sd">                inclination list</span>
<span class="sd">            O (list):</span>
<span class="sd">                right ascension of the ascending node list</span>
<span class="sd">            w (list):</span>
<span class="sd">                longitude of periapsis list</span>
<span class="sd">            lM (list):</span>
<span class="sd">                mean longitude list</span>
<span class="sd">                </span>
<span class="sd">        Each of these lists has a maximum of 4 elements. The values in </span>
<span class="sd">        these lists are used to propagate the solar system planetary </span>
<span class="sd">        ephemerides for a specific solar system planet.</span>
<span class="sd">        </span>
<span class="sd">        Attributes:</span>
<span class="sd">            a (list):</span>
<span class="sd">                list of semimajor axis (in AU)</span>
<span class="sd">            e (list):</span>
<span class="sd">                list of eccentricity</span>
<span class="sd">            I (list):</span>
<span class="sd">                list of inclination</span>
<span class="sd">            O (list):</span>
<span class="sd">                list of right ascension of the ascending node</span>
<span class="sd">            w (list):</span>
<span class="sd">                list of longitude of periapsis</span>
<span class="sd">            lM (list):</span>
<span class="sd">                list of mean longitude values</span>
<span class="sd">            </span>
<span class="sd">        Each of these lists has a maximum of 4 elements. The values in </span>
<span class="sd">        these lists are used to propagate the solar system planetary </span>
<span class="sd">        ephemerides for a specific solar system planet.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">O</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">lM</span><span class="p">):</span>
            
            <span class="c1"># store list of semimajor axis values (convert from AU to km)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">AU</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;km&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="c1"># store list of dimensionless eccentricity values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">e</span>
            <span class="c1"># store list of inclination values (degrees)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I</span> <span class="o">=</span> <span class="n">I</span>
            <span class="c1"># store list of right ascension of ascending node values (degrees)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">O</span> <span class="o">=</span> <span class="n">O</span> 
            <span class="c1"># store list of longitude of periapsis values (degrees)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">w</span> 
            <span class="c1"># store list of mean longitude values (degrees)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lM</span> <span class="o">=</span> <span class="n">lM</span>

        <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;String representation of the SolarEph object</span>
<span class="sd">            </span>
<span class="sd">            When the command &#39;print&#39; is used on the SolarEph object, this </span>
<span class="sd">            method will print the attribute values contained in the object</span>
<span class="sd">            </span>
<span class="sd">            &quot;&quot;&quot;</span>
            
            <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">att</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">att</span><span class="p">)))</span>
            </div></div>
            <span class="k">return</span> <span class="s1">&#39;SolarEph class object attributes&#39;</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015 - 2017, SIOSlab.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
    </div>

    

    
  </body>
</html>